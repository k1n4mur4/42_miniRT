# miniRT — MiniLibX で作る最初のレイトレーサ（逐語訳）

**要約（Summary）**: 本プロジェクトは、レイトレーシングという美しい世界への入門です。  
この課題をやり終えるころには、シンプルなコンピュータ生成画像（CGI）をレンダリングできるようになり、数式の実装を恐れなくなるでしょう。

**バージョン**: 9.0

---

## 目次（Contents）
- I はじめに（Introduction） … 2  
- II 共通ルール（Common Instructions） … 3  
- III AI に関する指針（AI Instructions） … 5  
- IV 必須パート — miniRT（Mandatory part - miniRT） … 7  
- V ボーナス（Bonus part） … 12  
- VI 例（Examples） … 14  
- VII 提出とピア評価（Submission and peer-evaluation） … 19  

---

# I. はじめに（Introduction）

三次元のコンピュータ生成画像（CGI）をレンダリングする方法には、大きく分けて 2 つのアプローチがあります。  
効率性の観点から、ほぼすべてのグラフィックスエンジンで用いられている **ラスタライズ**、そして **レイトレーシング** です。

レイトレーシングの手法は最初に **1968 年**に開発され（その後、改良が重ねられてきました）、現在でもラスタライズより **計算コストが高い**方法です。  
その結果、未だリアルタイム用途には完全には適合していませんが、**はるかに高い視覚的リアリズム**を生み出します。

> 図 I.1: 上の画像はレイトレーシング技法によりレンダリングされています。印象的ですよね？

高品質なグラフィックスを作る前に、まずは基礎をしっかり身につける必要があります。  
**miniRT** は、C 言語で書くあなたの **最初のレイトレーサ**で、規約順守、控えめながらも機能的です。

miniRT の主な目的は、**数学者でなくても** あらゆる **数学／物理の式を実装** できることを自分自身に証明することです。  
ここでは **最も基本的なレイトレーシング機能** のみを実装します。  
落ち着いて、深呼吸して、パニックにならないでください。  
このプロジェクトを終える頃には、学校で過ごした時間を正当化できるような **見栄えの良い画像** を披露できるはずです。

---

# II. 共通ルール（Common Instructions）

- プロジェクトは **C 言語** で書くこと。

- **Norm（コーディング規約）** に従って書くこと。ボーナスのファイル／関数も Norm のチェック対象であり、**Norm エラーが 1 つでもあると 0 点** になります。

- 未定義動作を除き、関数が **予期せず終了**（セグメンテーションフォールト、バスエラー、二重解放など）してはなりません。  
  そうした挙動が発生した場合、そのプロジェクトは **非機能** とみなされ、評価で **0 点** となります。

- ヒープ確保したメモリは必要に応じて **正しく解放** すること。**メモリリークは禁止** です。

- 課題で求められる場合、`cc` を使い、`-Wall -Wextra -Werror` を付けて必要な出力を生成する **Makefile** を提出すること。  
  **不要な再リンクは禁止** です。Makefile には少なくとも `$(NAME)`, `all`, `clean`, `fclean`, `re` のルールを含めてください。

- ボーナスを提出する場合、Makefile に **`bonus` ルール** を含め、メインパートで許可されていないヘッダ／ライブラリ／関数を追加して構いません。  
  ボーナスのコードは、特記がない限り **`_bonus.{c/h}`** ファイルに配置します。**必須とボーナスの評価は別々** に行われます。

- `libft` の使用が許可される場合は、そのソースと Makefile を **`libft/`** にコピーしてください。  
  プロジェクトの Makefile は `libft` を **その Makefile でビルド** し、その後にプロジェクトをビルドする必要があります。

- 提出対象ではありませんが、**テストプログラムの作成を推奨** します。自分やピアの作業を容易にテストでき、特に **ディフェンス時** に有用です。  
  ディフェンスでは **自分や相手のテスト** を自由に使用できます。

- 課題は **割り当てられた Git リポジトリ** に提出してください。**評価対象は Git リポジトリ内の作業のみ** です。  
  Deepthought による採点はピア評価の後に行われます。採点中にいずれかのセクションでエラーが起きると **そこで評価は停止** します。

---

# III. AI に関する指針（AI Instructions）

## コンテキスト
学習の過程で、AI は多様なタスクを支援できます。AI ツールの能力を把握し、自分の作業をどのように支えられるかを探ってください。  
ただし **常に注意深く** 使い、結果を **批判的に評価** しましょう。  
コード、ドキュメント、アイデア、技術解説などについて、**質問が適切に書けているとは限らず**、**生成内容が正確とも限りません**。  
ミスや見落としを避けるには、**ピア（同僚・学友）** は貴重な資源です。

## 主メッセージ
- **AI を使って**、繰り返しや退屈な作業を減らしましょう。  
- **プロンプト設計力**（コーディング／非コーディング双方）を鍛え、将来に活かしましょう。  
- **AI システムの仕組み** を学び、よくあるリスク・バイアス・倫理的課題を見越して回避しましょう。  
- **ピアと協働** して、テクニカルスキルとパワースキルを伸ばし続けましょう。  
- **自分が理解し責任を持てる** AI 生成物のみを使用しましょう。

## 学習者ルール
- AI ツールを探求し、**仕組みを理解** して、倫理的に使い、バイアスを減らします。  
- プロンプトを書く前に **自分の問題を省察** し、**明確・詳細・適切な語彙** でプロンプトを書きます。  
- AI の生成物は **体系的に検証・見直し・疑問視・テスト** する習慣をつけます。  
- **必ずピアレビュー** を受け、自己検証のみに頼らないようにします。

## フェーズ成果
- 汎用／領域特化の **プロンプトスキルを開発** します。  
- AI ツールを効果的に使って **生産性を高め** ます。  
- **計算論的思考・問題解決力・適応力・協業力** を鍛え続けます。

## コメントと例
- 試験や評価など、**実理解の証明が求められる状況** に頻繁に遭遇します。準備し、**技術的／対人スキル** を磨き続けてください。  
- **推論を説明** し、**ピアと議論** することで、理解のギャップが可視化されます。ピアラーニングを優先しましょう。  
- AI ツールはしばしば **あなた固有の文脈を欠き**、**一般的な回答** を返しがちです。**同じ環境を共有するピア** は、より関連性の高い洞察を提供できます。  
- AI は **最もありそうな答え** を生成しがちですが、ピアは **代替視点** や **有益なニュアンス** を与えてくれます。品質の関所として頼りましょう。

**良い例**:  
AI に「ソート関数をどうテストする？」と尋ね、いくつかのアイデアを得る。試して結果をピアと見直し、アプローチを一緒に洗練する。

**悪い例**:  
AI に関数全体を書かせ、コピペでプロジェクトに投入。評価で何をしているか説明できず、信用を失い、プロジェクトに失敗する。

**良い例**:  
AI にパーサ設計を手伝ってもらい、ロジックをピアと一緒にウォークスルー。バグを 2 つ見つけ、より良く・よりクリーンに書き直す（理解済み）。

**悪い例**:  
Copilot にプロジェクトの要部を生成させる。コンパイルは通るが、パイプ処理の説明ができない。評価で正当化できず失敗。

---

# IV. 必須パート — miniRT（Mandatory part - miniRT）

## 概要（Summary Table）

| 項目 | 内容 |
|---|---|
| **プログラム名** | `miniRT` |
| **提出物** | すべてのファイル |
| **Makefile** | `all`, `clean`, `fclean`, `re`, `bonus` |
| **引数** | `*.rt` 形式のシーンファイル |
| **使用可能な外部関数** | `open`, `close`, `read`, `write`, `printf`, `malloc`, `free`, `perror`, `strerror`, `exit` / **数学ライブラリ** のすべての関数（`man math.h` または `man 3 math`。**リンク時に `-lm` を忘れないこと**） / **MiniLibX** のすべての関数 / `gettimeofday()` |
| **libft 使用** | 可 |
| **説明** | レイトレーシング手法で画像を生成します。各画像は、単純な幾何オブジェクトと照明で定義されたシーンを、特定の角度と位置から見たものを表します。 |

## 制約（Constraints）

- **MiniLibX** を必ず使用すること。OS にある版でもソースからでも可。ソースから使う場合は、`libft` と同様のルールを適用すること。  
- ウィンドウの管理は **滑らか** であること（他ウィンドウへの切り替え、最小化など）。  
- 少なくとも次の **3 種の単純幾何オブジェクト** を実装すること：**平面（plane）**, **球（sphere）**, **円柱（cylinder）**。  
- 必要に応じて、**すべての交差判定** と **オブジェクト内部** を正しく扱うこと。  
- オブジェクトの **固有プロパティのリサイズ** に対応すること（球の直径、円柱の直径と高さ）。  
- オブジェクト／ライト／カメラに対して **並進・回転** を適用できること（**球とライトは回転不可**）。  
- ライト管理：**スポットの明るさ**, **ハードシャドウ**, **環境光（完全な暗黒にならない）**。**環境光と拡散反射（ambient & diffuse）** を実装すること。  
- 画像はウィンドウに表示し、次を満たすこと：  
  - **ESC キー**でウィンドウを閉じ、**クリーンに終了**。  
  - ウィンドウ枠の **赤い×（クローズボタン）** クリックでウィンドウを閉じ、**クリーンに終了**。  
  - **MiniLibX の画像機能の使用を強く推奨**。

- プログラムの第 1 引数は **`.rt` 拡張子** のシーン記述ファイルです。  
  - 各要素タイプは **1 行以上の改行** で区切ることができます。  
  - 各要素の各情報は **1 個以上の空白** で区切ることができます。  
  - 各要素タイプは **任意の順序** で並べられます。  
  - **大文字** で識別される要素は **シーン中に 1 回のみ** 宣言できます。  
  - 各要素の最初の情報は **タイプ識別子**（1～2 文字）。続いて **そのオブジェクト特有の情報** を **厳密な順序** で記述します。

## 要素の書式（Element formats）

- **環境光（Ambient lighting）**  
  ```
  A 0.2 255,255,255
  ```
  - 識別子: `A`  
  - 環境光の比率 `[0.0, 1.0]`: `0.2`  
  - 色（R,G,B）`[0-255]`: `255,255,255`

- **カメラ（Camera）**  
  ```
  C -50.0,0,20 0,0,1 70
  ```
  - 識別子: `C`  
  - 視点の座標 (x,y,z): `-50.0,0,20`  
  - **正規化 3D 方向ベクトル**（各軸 `[-1,1]`）: `0.0,0.0,1.0`  
  - 水平 **FOV**（度）`[0,180]`: `70`

- **ライト（Light）**  
  ```
  L -40.0,50.0,0.0 0.6 10,0,255
  ```
  - 識別子: `L`  
  - 光源位置 (x,y,z): `-40.0,50.0,0.0`  
  - 輝度比 `[0.0,1.0]`: `0.6`  
  - **（必須では未使用）** 色（R,G,B）`[0-255]`: `10,0,255`

- **球（Sphere）**  
  ```
  sp 0.0,0.0,20.6 12.6 10,0,255
  ```
  - 識別子: `sp`  
  - 中心座標 (x,y,z): `0.0,0.0,20.6`  
  - 直径: `12.6`  
  - 色（R,G,B）`[0-255]`: `10,0,255`

- **平面（Plane）**  
  ```
  pl 0.0,0.0,-10.0 0.0,1.0,0.0 0,0,225
  ```
  - 識別子: `pl`  
  - 平面上の 1 点 (x,y,z): `0.0,0.0,-10.0`  
  - **正規化法線ベクトル**（各軸 `[-1,1]`）: `0.0,1.0,0.0`  
  - 色（R,G,B）`[0-255]`: `0,0,225`

- **円柱（Cylinder）**  
  ```
  cy 50.0,0.0,20.6 0.0,0.0,1.0 14.2 21.42 10,0,255
  ```
  - 識別子: `cy`  
  - 中心座標 (x,y,z): `50.0,0.0,20.6`  
  - **正規化軸ベクトル**（各軸 `[-1,1]`）: `0.0,0.0,1.0`  
  - 直径: `14.2`  
  - 高さ: `21.42`  
  - 色（R,G,B）`[0-255]`: `10,0,255`

### 最小構成の `.rt` 例（必須パート）

```
A 0.2 255,255,255

C -50,0,20 0,0,1 70
L -40,0,30 0.7 255,255,255

pl 0,0,0 0,1.0,0 255,0,225
sp 0,0,20 20 255,0,0
cy 50.0,0.0,20.6 0,0,1.0 14.2 21.42 10,0,255
```

- ファイル内で **いかなる種別のミスコンフィグ** が検出された場合でも、プログラムは **適切に終了** し、`"Error
"` に続けて **明確なエラーメッセージ**（内容は任意）を表示しなければなりません。  
- ディフェンスでは、**機能に焦点を当てたシーン一式** を用意しておくと検証が楽になります。

---

# V. ボーナス（Bonus part）

レイトレーシングは、反射、透明、屈折、複雑なオブジェクト、ソフトシャドウ、コースティクス、グローバルイルミネーション、バンプマッピング、`.obj` レンダリング等、さらに多くを扱えます。

しかし miniRT では、あなたの **最初のレイトレーサ** かつ **CGI の最初の一歩** として、**シンプルさ** を保ちます。

> 図 V.1: スポットライト、宇宙のスカイボックス、バンプマッピングを用いた光沢のある地球テクスチャの球

**重要**: ボーナスは **必須パートが完全** な場合にのみ評価されます。  
「完全」とは、**全要素が揃い**、**誤用などの不快なミスにも落ちない** こと、評価で **満点** であることを意味します。  
必須が満点でない場合、**ボーナスは全て無視** されます。

**ボーナス候補一覧**:
- **鏡面反射** を追加して **Phong 反射モデルを完成** させる。  
- **色の分割**（チェッカーボード模様）。  
- **カラー** かつ **複数スポットライト**。  
- **もう 1 種の 2 次曲面**（円錐、双曲面、放物面 など）。  
- **バンプマップ** テクスチャに対応。

ボーナスを満たすために **他の関数や機能を追加** して構いません。**シーン説明の拡張** も評価時に正当化できるなら可。  
必要に応じて **シーンファイル形式を変更** しても構いません。**賢くやりましょう！**

---

# VI. 例（Examples）

- **図 VI.1**: 球、スポット 1 つ、（任意の）光沢。  
- **図 VI.2**: 円柱、スポット 1 つ。  
- **図 VI.3**: （任意の）円錐、平面、スポット 1 つ。  
- **図 VI.4**: いろいろ（平面 2 枚を含む）。  
- **図 VI.5**: 同じシーン、別カメラ。  
- **図 VI.6**: 今度はシャドウあり。  
- **図 VI.7**: 複数スポット。  
- **図 VI.8**: 複数スポットに加え、中央に光沢のある **チェック柄（任意）** の球。

---

# VII. 提出とピア評価（Submission and peer-evaluation）

- 通常どおり **Git リポジトリ** に提出します。**評価対象はリポジトリ内の作業のみ** です。ファイル名が正しいか **再確認** しましょう。

- 評価中に、プロジェクトの **軽微な変更** を求められることがあります。  
  これは、**挙動の小変更**、**数行のコードの追加／書き換え**、**容易に追加できる機能** などに該当します。  
  このステップは **すべてのプロジェクトで必ずあるわけではありません** が、**評価指針に記載があれば準備が必要** です。

- このステップは、プロジェクトの **特定部分についてあなたが本当に理解しているか** を確認するためのものです。  
  変更は、あなたが選ぶ **任意の開発環境**（たとえば普段のセットアップ）で行えます。  
  **数分で可能** であるべきですが、評価の一部として **特定の時間枠が定義** される場合はその限りではありません。

- 例として、関数またはスクリプトの小さな更新、表示の変更、新情報を格納するための **データ構造の調整** などを求められることがあります。

- 詳細（範囲・対象など）は **評価指針** で指定され、**同じプロジェクトでも評価ごとに異なる** 場合があります。

```
???????????? XXXXXXXXXX = $3$$f2c51fc265cf7e70865cb1bd24214beb
```

---

> 出典: ユーザー提供の PDF「miniRT v9」（全 20 ページ）を基にした逐語訳。